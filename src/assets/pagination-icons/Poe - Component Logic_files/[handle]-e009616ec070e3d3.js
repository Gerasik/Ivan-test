(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6616],{25987:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[handle]",function(){return a(48111)}])},47796:function(e,t,a){"use strict";a.r(t);let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SprigSurvey_viewer",selections:[{alias:null,args:null,kind:"ScalarField",name:"uid",storageKey:null}],type:"Viewer",abstractKey:null};i.hash="3754aeacd298f6c96313e086d278b0cb",t.default=i},15421:function(e,t,a){"use strict";a.r(t);let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"optimisticChat_useCreateOptimisticChat_bot",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"introduction",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"nickname",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null}],type:"Bot",abstractKey:null};i.hash="4cb48ebe801cb479e1334ef3134091b6",t.default=i},16122:function(e,t,a){"use strict";a.r(t);let i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"optimisticChat_useOptimisticChat_bot",selections:[{args:null,kind:"FragmentSpread",name:"optimisticChat_useCreateOptimisticChat_bot"}],type:"Bot",abstractKey:null};i.hash="90699b91cac95b49724818a1cd06739d",t.default=i},77573:function(e,t,a){"use strict";a.d(t,{f:function(){return useSprigSurvey},i:function(){return logoutUserInSprig}});var i=a(67294),n=a(22578);let initSprig=async()=>{if(window.Sprig)return window.Sprig;let{sprig:e}=await a.e(2141).then(a.bind(a,59236));return e.configure({environmentId:"OFiT3eT6FKrU"})},useSprigSurvey=e=>{let t=(0,n.useFragment)(a(47796),e);(0,i.useEffect)(()=>{initSprig().then(e=>{t.uid&&e("setUserId","".concat(t.uid))})},[t.uid])},logoutUserInSprig=async()=>{let e=await initSprig();e("logoutUser")}},55554:function(e,t,a){"use strict";a.d(t,{F5:function(){return useCreateOptimisticChat},t3:function(){return useOptimisticChat}});var i=a(41143),n=a.n(i),s=a(67294),c=a(22578),l=a(44311);let gen_random_number=()=>Math.floor(1e9*Math.random()),getOptimisticChatId=e=>"OPTIMISTIC_CHAT_".concat(e),getOptimisticMessagesConnectionId=e=>l.ConnectionHandler.getConnectionID(e,"ChatMessagesView_chat_messagesConnection"),getOptimisticMessagePageInfoId=e=>"".concat(e,"_MESSAGE_PAGE_INFO"),getOptimisticMemberPageInfoId=e=>"".concat(e,"_MEMBER_PAGE_INFO"),getOptimisticIntroMessageId=e=>"".concat(e,"_INTRO_MESSAGE"),getOptimisticIntroMessageEdgeId=e=>"".concat(e,"_INTRO_MESSAGE_EDGE"),getOptimisticMembersConnectionId=e=>"".concat(e,"_MEMBERS_CONNECTION"),getOptimisticBotMemberEdgeId=e=>"".concat(e,"_BOT_MEMBER_EDGE"),getOptimisticFileId=(e,t)=>"".concat(e,"_FILE_").concat(t),getOptimisticMessageAttachmentId=(e,t)=>"".concat(e,"_MESSAGE_ATTACHMENT_").concat(t),createOptimisticAttachment=(e,t,a,i)=>{let n=t.getDataID(),s=getOptimisticFileId(n,i),c=e.create(s,"File");c.setValue(s,"id"),c.setValue("text","fileFormat"),c.setValue("OPTIMISTIC_FILE_HASH","fileHash"),c.setValue(a.type,"mimeType"),c.setValue(null,"processedUrl"),c.setValue(a.size,"size"),c.setValue("","url");let l=getOptimisticMessageAttachmentId(n,i),r=e.create(l,"MessageAttachment");return r.setValue(l,"id"),r.setValue(l,"attachmentId"),r.setValue(a.name,"name"),r.setLinkedRecord(c,"file"),r.setLinkedRecord(t,"message"),r},createOptimisticMessage=function(e,t,a,i,n,s){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],l=e.create(a,"Message");return l.setValue(a,"id"),l.setValue(a,"messageId"),l.setValue(i,"text"),l.setValue(s,"state"),l.setValue(n,"author"),l.setValue(n,"authorNickname"),l.setValue("chat_input","sourceType"),l.setValue("not_truncated","attachmentTruncationState"),l.setValue(1e3*Date.now(),"creationTime"),l.setValue("","clientNonce"),l.setValue(null,"textLengthOnCancellation"),l.setValue(null,"uid"),l.setValue(null,"vote"),l.setValue(null,"voteReason"),l.setValue([],"suggestedReplies"),l.setLinkedRecord(t,"chat"),l.setLinkedRecords(c.map((t,a)=>createOptimisticAttachment(e,l,t,a)),"attachments"),l.setValue(!0,"isOptimistic"),l.setValue(0,"timeoutLevel"),l.setValue(null,"offlineError"),l.setValue(null,"textLengthOnCancellationImmediate"),l},useOptimisticChat=(e,t)=>{let i=(0,c.useFragment)(a(16122),e),n=useCreateOptimisticChat(i),[l]=(0,s.useState)(()=>t||n());return l},useCreateOptimisticChat=e=>{let{introduction:t,id:i,nickname:n,model:l}=(0,c.useFragment)(a(15421),e),r=(0,c.useRelayEnvironment)();return(0,s.useCallback)(()=>createOptimisticChat({environment:r,botId:i,botNickname:n,botModel:l,introduction:t}),[r,i,n,l,t])},createOptimisticChat=e=>{let t,a,{environment:i,botId:s,botNickname:c,botModel:r,introduction:o}=e;return(0,l.commitLocalUpdate)(i,e=>{let i=e.get(s);for(n()(i,"bot is ".concat(i));!t||e.get(t);)t=getOptimisticChatId(a=gen_random_number());let l=e.create(t,"Chat");l.setValue(t,"id"),l.setValue(t,"chatId"),l.setValue("","chatCode"),l.setValue(!0,"isOptimistic"),l.setValue(c,"defaultBotNickname"),l.setValue(1e3*Date.now(),"creationTime"),l.setValue(1e3*Date.now(),"lastInteractionTime"),l.setValue(null,"title"),l.setValue(!0,"shouldShowDisclaimer"),l.setValue(1e3*Date.now(),"creationTime"),l.setLinkedRecord(i,"defaultBotObject");let u=getOptimisticIntroMessageId(t),d=o?[createOptimisticMessage(e,l,u,o,r,"complete")]:[],m=d.map(a=>{n()(t,"chatId is ".concat(t));let i=e.create(getOptimisticIntroMessageEdgeId(t),"MessageEdge");return i.setLinkedRecord(a,"node"),i}),g=e.create(getOptimisticMessagePageInfoId(t),"PageInfo");g.setValue(!1,"hasPreviousPage"),g.setValue(o?u:null,"startCursor");let p=e.create(getOptimisticMessagesConnectionId(t),"MessagesConnection");p.setLinkedRecords(m,"edges"),p.setLinkedRecord(g,"pageInfo"),l.setLinkedRecord(p,"messagesConnection",{last:5}),l.setLinkedRecord(p,"__ChatMessagesView_chat_messagesConnection_connection");let h=[e.create(getOptimisticBotMemberEdgeId(t),"ChatMemberEdge")];h[0].setLinkedRecord(i,"node");let I=e.create(getOptimisticMemberPageInfoId(t),"PageInfo");I.setValue(!1,"hasNextPage"),I.setValue(h[0].getDataID(),"endCursor");let _=e.create(getOptimisticMembersConnectionId(t),"ChatMemberConnection");_.setLinkedRecords(h,"edges"),_.setLinkedRecord(I,"pageInfo"),l.setLinkedRecord(_,"membersConnection"),e.getRoot().setLinkedRecord(l,"optimisticChat",{optimisticChatId:t})}),n()(t,"chatId is ".concat(t)),n()(a,"chatIdNumber is ".concat(a)),t}},20308:function(e,t,a){"use strict";var i=a(67294);t.Z=()=>{let[e,t]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{t(!0)},[t]),e}}},function(e){e.O(0,[1664,5675,3253,8496,9386,6503,9898,5333,2846,8687,1892,4067,8348,8111,9774,2888,179],function(){return e(e.s=25987)}),_N_E=e.O()}]);